//ICC-AVR application builder : 2012/2/13 20:52:33
/*******************************************************************************
* ┡v:     れJ歆
*
* 虫诀:   ATMAGE8
* 垂:     ~场8MHz
* s亩竟:   ICC 7.22
*
* ゅンW:   main.c
* @:     れJ歆
* ━:     1.0
*
* u慌:     https://i.youku.com/gzguava
*
* ^_G    https://gzguava.taobao.com
*
* \啻yz: b8M垂钉U,龟{8涌Wミ龄L陪ボ6隔LEDO
*******************************************************************************/

/*********************************]tYゅン********************************/
#include <iom8v.h>
#include <macros.h>
 
#define LED PORTC
int flag = 0;
int count = 0;
/******************************************************************************* 
* ㄧ计W嘿: delay_us()
* Jf把计: microsecond : 块J┑煞L愍寒啥
* Xf把计: 
* \啻yz: L愍憨诞   	  	
*******************************************************************************/ 
void delay_us(unsigned int microsecond) 
{      
    do 
	{ 
        microsecond--; 
	}
    while (microsecond>1);
}
/******************************************************************************* 
* ㄧ计W嘿: delay_ms()
* Jf把计: millisecond : 块J┑刹@愍寒啥
* Xf把计: 
* \啻yz: @愍憨诞  	
*******************************************************************************/ 
void delay_ms(unsigned int millisecond) 
{      
    while (millisecond--)
	{
        delay_us(999);
	}
}
/******************************************************************************* 
* ㄧ计W嘿: void key_scan(void)
* Jf把计: 
* Xf把计: 
* \啻yz: 龄L苯y
*******************************************************************************/
void key_scan(void)
{
	PORTB = 0XFF;
	delay_ms(10);
	if((PINB&0x3F)!=0x3F)     //安p1~8聋龆sΤQ訾Uh(=0) 
	{ 
		delay_ms(20);
		if((PINB&0X3E) == 0X3E) //0X3E = S1龆s
		{ 
			delay_ms(20);
			flag = 0;
			while((PINB) == 0X3E)
			{
				flag = flag + 1;
				delay_ms(50);
			}
			if(flag >= 20)
			{
				LED = 1;
			}
			else if(flag <= 20)
			{
				LED = 2;
			}
		}
		else if((PINB&0X3B) == 0X3B)//0X3B = S2龆s
		{ 
			delay_ms(20);
			if(count == 0)
			{
				LED = 3;
				count = count + 1;
				delay_ms(100);
			}
			else if(count == 1)
			{
				LED = 4;
				count = 0;
				delay_ms(100);
			}
			//LED = 1 |单 LED = 0XF1ALED = 2 |单 LED = 0XF2AH姑崩 
		}
	delay_ms(1);
	}

}
/******************************************************************************* 
* ㄧ计W嘿: 
* Jf把计: 
* Xf把计: 
* \啻yz: 
*******************************************************************************/ 
void port_int(void)
{
      //stop errant interrupts until set up
     CLI(); //disable all interrupts
     DDRB = 0XC0;//1100 0000
	 PORTB = 0XFF;
	 DDRC  = 0x3F;//0011 1111
     PORTC = 0xFF; 
	 MCUCR = 0x00;
	 GICR  = 0x00;
	 TIMSK = 0x00; //timer interrupt sources
	 SEI();
}
/****************************************************************************
ㄧ计\:┑嗓l{
Jf把计:
Xf把计:
****************************************************************************/
void delay(void)
{
 	 int i;
  	 for(i=0;i<200;i++);
}
/****************************************************************************
ㄧ计\:D{
Jf把计:
Xf把计:
****************************************************************************/
void main(void)
{
	 port_int();
	 LED = 0XFF;
	 while(1)
	 {
	    key_scan(); 
	 }
}